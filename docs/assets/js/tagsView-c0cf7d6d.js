import{_ as Te,a as J,u as Re,c as be,b as _e,o as Q,e as d,S as y,g as Z}from"./index-0e025919.js";import{w as C}from"./_@vue_runtime-dom@3.3.4@@vue-333a3aa0.js";import{u as xe,b as Se,o as qe}from"./_vue-router@4.2.4@vue-router-2f261a7a.js";import{S as De}from"./_sortablejs@1.15.0@sortablejs-0d19b1d3.js";import{s as $}from"./_pinia@2.1.6@pinia-7dcc81d4.js";import{a as Ae}from"./_element-plus@2.3.9@element-plus-1f0d90d6.js";import{A as te,a0 as Ie,l as O,y as ke,N as Pe,W as Ue,n as $e,w as Oe,V as ee,o as h,c as T,i as E,I as Ee,a as se,F as ae,S as Me,L as R,H as M,p as N}from"./_@vue_runtime-core@3.3.4@@vue-95679d18.js";import{r as q,j as Ne,u as je}from"./_@vue_reactivity@3.3.4@@vue-7ec0c22d.js";import{o as j,M as Be}from"./_@vue_shared@3.3.4@@vue-bf8f17aa.js";import{_ as We}from"./_plugin-vue_export-helper-c27b6911.js";import"./_js-cookie@3.0.5@js-cookie-edb2da2a.js";import"./_@element-plus_icons-vue@2.1.0@@element-plus-5b665c84.js";import"./_nprogress@0.2.0@nprogress-3926d3a9.js";import"./_call-bind@1.0.2@call-bind-2adaad32.js";import"./_get-intrinsic@1.2.1@get-intrinsic-d63970a8.js";import"./_has-symbols@1.0.3@has-symbols-0b1e4796.js";import"./_has-proto@1.0.1@has-proto-eb3a7269.js";import"./_function-bind@1.1.1@function-bind-a5934397.js";import"./_has@1.0.3@has-9a2a5c25.js";import"./_axios@1.4.0@axios-4a70c6fc.js";import"./_qs@6.11.2@qs-d0adad9e.js";import"./_side-channel@1.0.4@side-channel-388bb2db.js";import"./_object-inspect@1.12.3@object-inspect-fcbc4da0.js";import"./_mitt@3.0.1@mitt-f7ef348c.js";import"./_vue-demi@0.14.5@vue-demi-71ba0ef2.js";import"./_lodash-es@4.17.21@lodash-es-36eb724a.js";import"./_@vueuse_core@9.13.0@@vueuse-b381c12a.js";import"./_@vueuse_shared@9.13.0@@vueuse-e525be63.js";import"./_@sxzz_popperjs-es@2.11.7@@sxzz-c75af06c.js";import"./_@ctrl_tinycolor@3.6.0@@ctrl-f8748455.js";import"./_dayjs@1.11.9@dayjs-d3042338.js";import"./_async-validator@4.2.5@async-validator-dee29e8b.js";import"./_memoize-one@6.0.0@memoize-one-297ddbcb.js";import"./_escape-html@1.0.3@escape-html-d5914612.js";import"./_normalize-wheel-es@1.2.0@normalize-wheel-es-ed76fb12.js";import"./_@floating-ui_dom@1.5.1@@floating-ui-9840f9e3.js";import"./_@floating-ui_core@1.4.1@@floating-ui-ba0bb945.js";import"./_@floating-ui_utils@0.1.1@@floating-ui-97c5a6c2.js";const ve=["data-url","onContextmenu","onMousedown","onClick"],Fe={key:0,class:"iconfont icon-webicon318 layout-navbars-tagsview-ul-li-iconfont"},He=te({name:"layoutTagsView"}),ze=te({...He,setup(Ke){const ie=Ie(()=>Te(()=>import("./contextmenu-25661071.js"),["./contextmenu-25661071.js","./_@vue_runtime-dom@3.3.4@@vue-333a3aa0.js","./_@vue_runtime-core@3.3.4@@vue-95679d18.js","./_@vue_reactivity@3.3.4@@vue-7ec0c22d.js","./_@vue_shared@3.3.4@@vue-bf8f17aa.js","./_plugin-vue_export-helper-c27b6911.js","../css/contextmenu-fae7b816.css"],import.meta.url)),f=q([]),b=q(),B=q(),re=q(),ne=J(),le=Re(),ue=J(),oe=be(),{themeConfig:W}=$(le),{tagsViewRoutes:v}=$(ue),{routesList:ce}=$(oe),w=_e(),m=xe(),c=Se(),t=Ne({routeActive:"",routePath:m.path,dropdown:{x:"",y:""},sortable:"",tagsRefsIndex:0,tagsViewList:[],tagsViewRoutesList:[]}),me=O(()=>W.value.tagsStyle),u=O(()=>W.value),fe=O(()=>s=>Q.setTagsViewNameI18n(s)),_=s=>u.value.isShareTagsView?s.path===t.routePath:s.query&&Object.keys(s.query).length||s.params&&Object.keys(s.params).length?s.url?s.url===t.routeActive:s.path===t.routeActive:s.path===t.routePath,p=s=>{y.set("tagsViewList",s)},F=async()=>{t.routeActive=await g(m),t.routePath=await m.meta.isDynamic?m.meta.isDynamicPath:m.path,t.tagsViewList=[],t.tagsViewRoutesList=v.value,pe()},pe=async()=>{y.get("tagsViewList")&&u.value.isCacheTagsView?t.tagsViewList=await y.get("tagsViewList"):(await t.tagsViewRoutesList.map(s=>{var e;(e=s.meta)!=null&&e.isAffix&&!s.meta.isHide&&(s.url=g(s),t.tagsViewList.push({...s}),w.addCachedView(s))}),await D(m.path,m)),Y(u.value.isShareTagsView?t.routePath:t.routeActive)},H=async(s,e)=>{var i,l;let a=(i=e==null?void 0:e.meta)!=null&&i.isDynamic?e.meta.isDynamicPath:s;if(t.tagsViewList.filter(n=>{var o,L;return n.path===a&&Z((o=e==null?void 0:e.meta)!=null&&o.isDynamic?n.params?n.params:null:n.query?n.query:null,(L=e==null?void 0:e.meta)!=null&&L.isDynamic?e!=null&&e.params?e==null?void 0:e.params:null:e!=null&&e.query?e==null?void 0:e.query:null)}).length<=0){let n=t.tagsViewRoutesList.find(o=>o.path===a);if(!n||n.meta.isAffix||n.meta.isLink&&!n.meta.isIframe)return!1;(l=e==null?void 0:e.meta)!=null&&l.isDynamic?n.params=e.params:n.query=e==null?void 0:e.query,n.url=g(n),t.tagsViewList.push({...n}),await w.addCachedView(n),p(t.tagsViewList)}},z=(s,e)=>{var r;let a=(r=e==null?void 0:e.meta)!=null&&r.isDynamic?e.meta.isDynamicPath:s;t.tagsViewList.forEach(i=>{var l,n,o;i.path===a&&!Z((l=e==null?void 0:e.meta)!=null&&l.isDynamic?i.params?i.params:null:i.query?i.query:null,(n=e==null?void 0:e.meta)!=null&&n.isDynamic?e!=null&&e.params?e==null?void 0:e.params:null:e!=null&&e.query?e==null?void 0:e.query:null)&&((o=e==null?void 0:e.meta)!=null&&o.isDynamic?i.params=e.params:i.query=e==null?void 0:e.query,i.url=g(i),p(t.tagsViewList))})},D=(s,e)=>{N(async()=>{var r,i,l;let a;if((r=e==null?void 0:e.meta)!=null&&r.isDynamic){if(u.value.isShareTagsView?await z(s,e):await H(s,e),t.tagsViewList.some(n=>{var o;return n.path===((o=e==null?void 0:e.meta)==null?void 0:o.isDynamicPath)}))return p(t.tagsViewList),!1;a=t.tagsViewRoutesList.find(n=>{var o;return n.path===((o=e==null?void 0:e.meta)==null?void 0:o.isDynamicPath)})}else{if(u.value.isShareTagsView?await z(s,e):await H(s,e),t.tagsViewList.some(n=>n.path===s))return p(t.tagsViewList),!1;a=t.tagsViewRoutesList.find(n=>n.path===s)}if(!a||(i=a==null?void 0:a.meta)!=null&&i.isLink&&!a.meta.isIframe)return!1;(l=e==null?void 0:e.meta)!=null&&l.isDynamic?a.params=e!=null&&e.params?e==null?void 0:e.params:m.params:a.query=e!=null&&e.query?e==null?void 0:e.query:m.query,a.url=g(a),await w.addCachedView(a),await t.tagsViewList.push({...a}),await p(t.tagsViewList)})},K=async s=>{var r;const e=decodeURI(s);let a={};if(t.tagsViewList.forEach(i=>{i.transUrl=V(i),i.transUrl?i.transUrl===V(i)&&(a=i):i.path===e&&(a=i)}),!a)return!1;await w.delCachedView(a),d.emit("onTagsViewRefreshRouterView",s),(r=a.meta)!=null&&r.isKeepAlive&&w.addCachedView(a)},A=s=>{t.tagsViewList.map((e,a,r)=>{var i;(i=e.meta)!=null&&i.isAffix||(u.value.isShareTagsView?e.path===s:e.url===s)&&(w.delCachedView(e),t.tagsViewList.splice(a,1),setTimeout(()=>{(t.tagsViewList.length===a&&u.value.isShareTagsView?t.routePath===s:t.routeActive===s)?r[r.length-1].meta.isDynamic?a!==r.length?c.push({name:r[a].name,params:r[a].params}):c.push({name:r[r.length-1].name,params:r[r.length-1].params}):a!==r.length?c.push({path:r[a].path,query:r[a].query}):c.push({path:r[r.length-1].path,query:r[r.length-1].query}):(t.tagsViewList.length!==a&&u.value.isShareTagsView?t.routePath===s:t.routeActive===s)&&(r[a].meta.isDynamic?c.push({name:r[a].name,params:r[a].params}):c.push({path:r[a].path,query:r[a].query}))},0))}),p(t.tagsViewList)},ge=s=>{y.get("tagsViewList")&&(t.tagsViewList=[],y.get("tagsViewList").map(e=>{var a;(a=e.meta)!=null&&a.isAffix&&!e.meta.isHide&&(e.url=g(e),w.delOthersCachedViews(e),t.tagsViewList.push({...e}))}),D(s,m),p(t.tagsViewList))},we=()=>{y.get("tagsViewList")&&(w.delAllCachedViews(),t.tagsViewList=[],y.get("tagsViewList").map(s=>{var e;(e=s.meta)!=null&&e.isAffix&&!s.meta.isHide&&(s.url=g(s),t.tagsViewList.push({...s}),c.push({path:t.tagsViewList[t.tagsViewList.length-1].path}))}),p(t.tagsViewList))},he=async s=>{const e=t.tagsViewList.find(a=>u.value.isShareTagsView?a.path===s:a.url===s);e.meta.isDynamic?await c.push({name:e.name,params:e.params}):await c.push({name:e.name,query:e.query}),ne.setCurrenFullscreen(!0)},X=s=>{let e={};return t.tagsViewList.forEach(a=>{a.transUrl=V(a),a.transUrl?a.transUrl===V(a)&&a.transUrl===s.commonUrl&&(e=a):a.path===decodeURI(s.path)&&(e=a)}),e||null},I=async s=>{if(s.commonUrl=V(s),!X(s))return Ae({type:"warning",message:"请正确输入路径及完整参数（query、params）"});const{path:e,name:a,params:r,query:i,meta:l,url:n}=X(s);switch(s.contextMenuClickId){case 0:l.isDynamic?await c.push({name:a,params:r}):await c.push({path:e,query:i}),K(m.fullPath);break;case 1:A(u.value.isShareTagsView?e:n);break;case 2:l.isDynamic?await c.push({name:a,params:r}):await c.push({path:e,query:i}),ge(e);break;case 3:we();break;case 4:he(u.value.isShareTagsView?e:n);break}},de=(s,e)=>{const{clientX:a,clientY:r}=e;t.dropdown.x=a,t.dropdown.y=r,B.value.openContextmenu(s)},ye=(s,e)=>{var a;if(!((a=s.meta)!=null&&a.isAffix)&&e.button===1){const r=Object.assign({},{contextMenuClickId:1,...s});I(r)}},Ve=(s,e)=>{t.tagsRefsIndex=e,c.push(s),u.value.layout==="columns"&&(ce.value.find(r=>r.path.indexOf(`/${s.path.split("/")[1]}`)>-1).children?u.value.isCollapse=!1:u.value.isCollapse=!0)},V=s=>{var r,i;let e=s.query&&Object.keys(s.query).length>0?s.query:s.params;if(!e)return"";let a="";for(let[l,n]of Object.entries(e))(r=s.meta)!=null&&r.isDynamic?a+=`/${n}`:a+=`&${l}=${n}`;return(i=s.meta)!=null&&i.isDynamic?s.isFnClick?decodeURI(s.path):`${s.path.split(":")[0]}${a.replace(/^\//,"")}`:`${s.path}${a.replace(/^&/,"?")}`},g=s=>{var r;let e=s.query&&Object.keys(s.query).length>0?s.query:s.params;if(!e||Object.keys(e).length<=0)return s.path;let a="";for(let i in e)a+=e[i];return`${(r=s.meta)!=null&&r.isDynamic?s.meta.isDynamicPath:s.path}-${a}`},Le=s=>{b.value.$refs.wrapRef.scrollLeft+=s.wheelDelta/4},Ce=()=>{N(()=>{if(f.value.length<=0)return!1;let s=f.value[t.tagsRefsIndex],e=t.tagsRefsIndex,a=f.value.length,r=f.value[0],i=f.value[f.value.length-1],l=b.value.$refs.wrapRef,n=l.scrollWidth,o=l.offsetWidth,L=l.scrollLeft,U=f.value[t.tagsRefsIndex-1],G=f.value[t.tagsRefsIndex+1],x=0,S=0;s===r?l.scrollLeft=0:s===i?l.scrollLeft=n-o:(e===0?x=r.offsetLeft-5:x=(U==null?void 0:U.offsetLeft)-5,e===a?S=i.offsetLeft+i.offsetWidth+5:S=G.offsetLeft+G.offsetWidth+5,S>L+o?l.scrollLeft=S-o:x<L&&(l.scrollLeft=x)),b.value.update()})},Y=s=>{N(async()=>{let e=await t.tagsViewList;t.tagsRefsIndex=e.findIndex(a=>u.value.isShareTagsView?a.path===s:a.url===s),Ce()})},k=async()=>{const s=document.querySelector(".layout-navbars-tagsview-ul");if(!s)return!1;t.sortable.el&&t.sortable.destroy(),t.sortable=De.create(s,{animation:300,dataIdAttr:"data-url",disabled:!u.value.isSortableTagsView,onEnd:()=>{const e=[];t.sortable.toArray().map(a=>{t.tagsViewList.map(r=>{r.url===a&&e.push({...r})})}),p(e)}})},P=async()=>{await k(),Q.isMobile()&&t.sortable.el&&t.sortable.destroy()};return ke(()=>{P(),window.addEventListener("resize",P),d.on("onCurrentContextmenuClick",s=>{s.isFnClick=!0,I(s)}),d.on("openOrCloseSortable",()=>{k()}),d.on("openShareTagsView",()=>{u.value.isShareTagsView&&(c.push("/home"),t.tagsViewList=[],t.tagsViewRoutesList.map(s=>{var e;(e=s.meta)!=null&&e.isAffix&&!s.meta.isHide&&(s.url=g(s),t.tagsViewList.push({...s}))}))})}),Pe(()=>{d.off("onCurrentContextmenuClick",()=>{}),d.off("openOrCloseSortable",()=>{}),d.off("openShareTagsView",()=>{}),window.removeEventListener("resize",P)}),Ue(()=>{f.value=[]}),$e(()=>{F(),k()}),qe(async s=>{t.routeActive=g(s),t.routePath=s.meta.isDynamic?s.meta.isDynamicPath:s.path,await D(s.path,s),Y(u.value.isShareTagsView?t.routePath:t.routeActive)}),Oe(()=>v.value,s=>{if(s.length===t.tagsViewRoutesList.length)return!1;F()},{deep:!0}),(s,e)=>{const a=ee("SvgIcon"),r=ee("el-scrollbar");return h(),T("div",{class:j(["layout-navbars-tagsview",{"layout-navbars-tagsview-shadow":u.value.layout==="classic"}])},[E(r,{ref_key:"scrollbarRef",ref:b,onWheel:C(Le,["prevent"])},{default:Ee(()=>[se("ul",{class:j(["layout-navbars-tagsview-ul",me.value]),ref_key:"tagsUlRef",ref:re},[(h(!0),T(ae,null,Me(t.tagsViewList,(i,l)=>(h(),T("li",{key:l,class:j(["layout-navbars-tagsview-ul-li",{"is-active":_(i)}]),"data-url":i.url,onContextmenu:C(n=>de(i,n),["prevent"]),onMousedown:n=>ye(i,n),onClick:n=>Ve(i,l),ref_for:!0,ref:n=>{n&&(f.value[l]=n)}},[_(i)?(h(),T("i",Fe)):R("",!0),!_(i)&&u.value.isTagsviewIcon?(h(),M(a,{key:1,name:i.meta.icon,class:"pr5"},null,8,["name"])):R("",!0),se("span",null,Be(fe.value(i)),1),_(i)?(h(),T(ae,{key:2},[E(a,{name:"ele-RefreshRight",class:"ml5 layout-navbars-tagsview-ul-li-refresh",onClick:e[0]||(e[0]=C(n=>K(s.$route.fullPath),["stop"]))}),i.meta.isAffix?R("",!0):(h(),M(a,{key:0,name:"ele-Close",class:"layout-navbars-tagsview-ul-li-icon layout-icon-active",onClick:C(n=>A(u.value.isShareTagsView?i.path:i.url),["stop"])},null,8,["onClick"]))],64)):R("",!0),i.meta.isAffix?R("",!0):(h(),M(a,{key:3,name:"ele-Close",class:"layout-navbars-tagsview-ul-li-icon layout-icon-three",onClick:C(n=>A(u.value.isShareTagsView?i.path:i.url),["stop"])},null,8,["onClick"]))],42,ve))),128))],2)]),_:1},8,["onWheel"]),E(je(ie),{dropdown:t.dropdown,ref_key:"contextmenuRef",ref:B,onCurrentContextmenuClick:I},null,8,["dropdown"])],2)}}});const ks=We(ze,[["__scopeId","data-v-9271cfa8"]]);export{ks as default};
